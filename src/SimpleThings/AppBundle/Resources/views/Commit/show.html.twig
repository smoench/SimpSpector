{% extends 'SimpleThingsAppBundle::layout.html.twig' %}
{% import 'SimpleThingsAppBundle::macros.html.twig' as _ %}

{% block content %}
    <div class="row">
        <div class="column wide sixteen">
            <div class="ui steps">
                {{ _.step('Home', 'where the <i class="icon heart"></i> is', 'icon home', path('homepage')) }}
                {{ _.step(commit.project.name, 'Project', 'icon cubes', path('project_show', {id: commit.project.id })) }}

                {% if commit.mergerequest %}
                    {{ _.step(commit.mergerequest.name, 'Merge Request', 'horizontally flipped share alternate icon', path('mergerequest_show', {id: commit.mergerequest.id })) }}
                {% else %}
                    {{ _.step('Master Branch', 'Branch', 'sitemap alternate icon', path('project_master', {id: commit.id })) }}
                {% endif %}

                {{ _.step('rev ' ~ commit.revision|slice(0, 8), 'Commit Report', 'icon file text', '') }}
            </div>
        </div>
    </div>

    {% if commit.status == constant('STATUS_NEW', commit) or commit.status == constant('STATUS_RUN', commit) %}
        <div class="row">
            <div class="column wide sixteen">
                <div class="ui icon warning message">
                    <i class="notched circle loading icon"></i>

                    <div class="content">
                        <div class="header">
                            Just a moment.. or two... or...
                        </div>
                        <p>Processing... refresh the page</p>
                    </div>
                </div>
            </div>
        </div>
    {% elseif commit.status == constant('STATUS_ERROR', commit) %}
        <div class="row">
            <div class="column wide sixteen">
                <div class="ui icon error message">
                    <i class="notched bug icon"></i>

                    <div class="content">
                        <div class="header">
                            Sorry about that, chief
                        </div>
                        <p>YOU have an ERROR! Ahhh...</p>
                    </div>
                </div>
            </div>
        </div>
    {% elseif commit.issues|length == 0 %}
        <div class="row">
            <div class="column wide sixteen">
                <div class="ui icon success message">
                    <i class="notched child icon"></i>

                    <div class="content">
                        <div class="header">
                            Congratulations, Gadget, I dont't know how you did it
                        </div>
                        <p>You have no issues!</p>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="row">
            <div class="column wide sixteen">
                <div class="ui icon yellow message">
                    <i class="emergency icon"></i>

                    <div class="content">
                        <div class="header">
                            Irregularities were found!
                        </div>
                        <p>Please help me...</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="column wide sixteen">
                <div class="ui segment">
                    <h3 class="ui header dividing">Issues {{ _.levels(commit.issues) }}</h3>

                    <div class="ui styled accordion">
                        {% for file,list in issues %}
                            <div class="title">
                                <div style="float: right">
                                    {{ _.levels(list) }}
                                </div>
                                <i class="dropdown icon"></i>
                                <i class="file icon"></i>
                                {{ file }}
                            </div>
                            <div class="content">
                                {% for issue in list %}
                                    <div class="ui top attached {{ issue|level_color }} message">
                                        <h4>
                                            <i class="{{ issue|level_icon }} icon"></i>
                                            {{ issue.gadget|upper }}
                                            {{ issue.level|upper }}
                                        </h4>

                                        <p>{{ issue.message }}</p>
                                    </div>

                                    {% if issue.codeSnippet is not empty %}
                                        <div class="ui attached segment">
                                            <div class="ui top right attached label">
                                                <a class="phpstorm"
                                                   href="http://localhost:8091/?message={{ issue.file }}:{{ issue.line }}">
                                                    <i class="lightning inverted circular icon"></i>
                                                </a>
                                                Line {{ issue.line }}
                                            </div>
                                            {{ issue.codeSnippet|raw }}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

{% endblock %}
